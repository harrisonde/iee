/**!
 * @cidekar/window-rivet version 1.0.0
 * Copyright 2019 Cidekar, LLC
 * @license Released under the Apache-2.0 license.
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t["window-rivet"]=i()}(this,function(){"use strict";var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};function t(t,i){function e(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}var a=(e.store={cache:{},hooks:{}},e.getConfiguration=function(t){return t?e.store.cache[t]:{}},e.listConfiguration=function(t){return void 0===t&&(t="cache"),e.store[t]},e.putConfiguration=function(t,i){void 0===t&&(t="cache"),Object.assign(e.store[t],i)},e);function e(){this.configuration={component:void 0,dispatcherOrigin:"*",receiverOrigin:"*",silent:!1,warningOrigin:!0},this.setConfiguration=function(t){try{return e.store.cache=Object.assign(e.store.cache,t),!0}catch(t){return t}},e.store.cache=this.configuration}function c(t){a.getConfiguration("silent")||console.warn(t)}var r=(o.bind=function(){function i(t){}["created","mounted"].forEach(function(t){try{o.register(t,i)}catch(t){c(t)}})},o.boot=function(){o.bind(),o.call("created")},o.call=function(t,i){var e=a.listConfiguration("hooks")[t];void 0!==e&&(e.callback&&e.callback.apply(o,[i]),e.lifecycle=!0,e.lineage=e.lineage.concat(["ready"]))},o.register=function(t,i,e){var n;void 0===i&&(i=null),void 0===e&&(e="register");try{var r=a.listConfiguration("hooks")[t];if(void 0===r){var o=((n={})[t]={lifecycle:e,callback:i,lineage:[e]},n);a.putConfiguration("hooks",o)}else void 0!==r&&(r.callback=i,r.lifecycle=e,r.lineage=r.lineage.concat([e]))}catch(t){c(t)}},o.ready=function(){var t=!1,i=a.listConfiguration("hooks");return i&&i.created.lifecycle&&i.mounted.lifecycle&&(t=!0),t},o);function o(){}var i=(s.boot=function(t){var i=t?"dispatcher":"receiver";r.register(i,null,"boot"),r.register(i,function(t){})},s);function s(t){var n=this;this.supported_message_types=["string","object"],this.target=null,this.targetOrigin=null,this.warningOrigin=null,this.bind=function(){n.listen("message",n.handler)},this.listen=function(t,i){try{n.target.addEventListener(t,i)}catch(t){c(t)}},this.handler=function(t){if(n.trusted(t.origin)&&t.data)try{n.isSupported(t)&&r.ready()&&("*"===n.targetOrigin&&n.warningOrigin&&c("[Receiver Component] Specify an exact receiver origin, the configuration requires an update! Failing to specify an exact target origin exposes your application to a XSS attack vector."),c(t),n.emit(t.data.event,t.data))}catch(t){c(t)}},this.emit=function(t,i){try{var e=new Event(t);Object.assign(e,i),n.target.dispatchEvent(e)}catch(t){c(t)}},this.isSupported=function(t){for(var i=!1,e=0;e<n.supported_message_types.length;e++)if(n.supported_message_types[e]===typeof t.data){i=!0;break}return i},this.message=function(t){try{if(!t)throw new Error("attempt to dispatch without payload");if(!t.event)throw new Error("attempt to dispatch without defining an event");"*"===n.targetOrigin&&n.warningOrigin&&c("[Dispatcher Component] Specify an exact receiver origin, the configuration requires an update! Failing to specify an exact target origin exposes your application to a XSS attack vector."),n.target.postMessage(t,n.targetOrigin)}catch(t){c(t)}},this.trusted=function(t){var i=!1,e=a.getConfiguration("dispatcherOrigin");if("string"==typeof e&&"*"===e&&(i=!0),"object"==typeof e)for(var n=0;n<e.length;n++)if(e[n]===t){i=!0;break}return i},this.warningOrigin=a.getConfiguration("warningOrigin"),"dispatcher"===t?(this.target=window.parent,this.targetOrigin=a.getConfiguration("receiverOrigin")):(this.target=window,this.targetOrigin=a.getConfiguration("dispatcherOrigin")),r.call(t),this.bind(t)}var g,u=(t(f,g=i),f);function f(){return g.call(this,"dispatcher")||this}var p,h,l=(t(d,p=i),d.boot=function(){i.boot("receiver")},d);function d(){var e=p.call(this,"receiver")||this;return e.handler=function(t){if(e.trusted(t.origin)&&t.data)try{e.isSupported(t)&&r.ready()&&("*"===e.targetOrigin&&e.warningOrigin&&c("[Receiver Component] Specify an exact receiver origin, the configuration requires an update! Failing to specify an exact target origin exposes your application to a XSS attack vector."),c(t),e.emit(t.data.event,t.data))}catch(t){c(t)}},e.message=function(t,i){try{if(!t)throw new Error("attempt to dispatch without payload");if(!t.event)throw new Error("attempt to dispatch without defining an event");"*"===e.targetOrigin&&e.warningOrigin&&c("[Dispatcher Component] Specify an exact receiver origin, the configuration requires an update! Failing to specify an exact target origin exposes your application to a XSS attack vector."),i?i.source.postMessage(t,i.origin):e.target.postMessage(t,e.targetOrigin)}catch(t){c(t)}},e}function v(){var i=h.call(this)||this;return i.boot=function(t){i.setConfiguration(t),r.boot(),u.boot(),l.boot(),r.call("mounted")},i}var y=new(t(v,h=a),v);function w(t){y.boot(t),this.dispatcher=u,this.receiver=l}return w.version="1.0.0",w});
